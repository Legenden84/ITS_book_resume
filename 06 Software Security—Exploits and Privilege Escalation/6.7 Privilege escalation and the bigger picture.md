# 6.7 Privilege Escalation and the Bigger Picture

## Overview
This section delves into privilege escalation, illustrating how attackers might progress from initial code execution to achieving their ultimate goals through a series of steps, including exploiting additional vulnerabilities.

## Attack Progression
- **Initial Foothold**: The attacker begins by running a piece of code on the victim machine, possibly via a buffer overflow exploit. This "base-camp code" may not be sufficient on its own to achieve the attacker's goals.
- **Stepping Stones**: The base-camp code is used to execute other programs, transfer control, or spawn new processes to progress the attack.
- **Privilege Escalation**: If the initial code does not have the necessary privileges, the attacker will attempt to elevate privileges to accomplish their objectives.

## Forms of Escalation
1. **From Fixed Functionality to Shell Access**: Gaining the ability to execute arbitrary commands.
   - The attacker moves from utilizing the predefined functionality of a compromised application to gaining access to a command shell. This allows the execution of any command and provides a broader range of actions that can be performed on the compromised system.

2. **From Sandbox to Full Filesystem Access**: Escaping isolated environments to access more system resources.
   - Sandboxes are designed to run code in a restricted environment to prevent potential malicious activities. Escaping a sandbox means that the attacker gains access to the entire filesystem, breaking out of the restricted environment and gaining the ability to manipulate the system more freely.

3. **From Non-root to UID 0**: Escalating to root-level privileges.
   - User ID (UID) 0 is reserved for the root user, which has the highest level of access on a Unix/Linux system. Escalating from a non-root user to UID 0 means that the attacker has gained the highest level of privileges available, allowing them to execute any command, change any setting, and access all files on the system.

4. **From User-Space to Kernel-Mode**: Gaining the highest level of system access.
   - Moving from user-space (where applications run) to kernel-mode (where the core parts of the operating system run) means that the attacker has gained access to the most privileged level of the system. This provides the ability to directly interact with hardware, manipulate system processes, and change kernel-level settings.

### Escalation via Root-owned Setuid
- A practical example involves exploiting a root-owned setuid program vulnerable to buffer overflow. The attacker supplies crafted input to execute arbitrary code, spawning a new shell with root privileges.

## Privileges and TCP/IP Ports
- Privileged ports (0-1023) require root access to bind to, creating an expectation of trust and security.
- If a network daemon operating on a privileged port is compromised, it can lead to immediate superuser access.

## Common Failures in Limiting Privileges
- Trust in services running on privileged ports can be misplaced, leading to potential vulnerabilities.
- Users, often for convenience, might operate using root accounts for regular tasks, increasing the risk of privilege escalation.

## Remote-Access Shellcode
- Similar to local exploits, remote attackers can exploit network daemons to spawn a root shell, maintaining communication over the network.
